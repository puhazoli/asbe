---

title: Simple usage of different acquisition functions


keywords: fastai
sidebar: home_sidebar



nb_path: "Acquisition_functions.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: Acquisition_functions.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">asbe.base</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">asbe.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">asbe.estimators</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">econml.orf</span> <span class="kn">import</span> <span class="n">DMLOrthoForest</span>
<span class="kn">from</span> <span class="nn">econml.dml</span> <span class="kn">import</span> <span class="n">CausalForestDML</span>
<span class="c1">#from causalml.inference.nn import CEVAE</span>
<span class="kn">from</span> <span class="nn">openbt.openbt</span> <span class="kn">import</span> <span class="n">OPENBT</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">econml</span>
<span class="kn">from</span> <span class="nn">sklearn.gaussian_process</span> <span class="kn">import</span> <span class="n">GaussianProcessRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.gaussian_process.kernels</span> <span class="kn">import</span> <span class="n">ConstantKernel</span><span class="p">,</span> <span class="n">RBF</span>
<span class="kn">from</span> <span class="nn">sklift.datasets</span> <span class="kn">import</span> <span class="n">fetch_megafon</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># y, X, t, ite, _, e = synthetic_data(mode=1, n=1000, p=5, sigma=1.0)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">fetch_megafon</span><span class="p">(</span><span class="n">return_X_y_t</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[:</span><span class="mi">1000</span><span class="p">,:]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[:</span><span class="mi">1000</span><span class="p">]</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[:</span><span class="mi">1000</span><span class="p">]</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># y0 = np.where(t == 0, y, y - ite)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">t_train</span><span class="p">,</span> <span class="n">t_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>  <span class="n">test_size</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1005</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X_training&quot;</span><span class="p">:</span> <span class="n">X_train</span><span class="p">,</span>
     <span class="s2">&quot;y_training&quot;</span><span class="p">:</span> <span class="n">y_train</span><span class="p">,</span>
     <span class="s2">&quot;t_training&quot;</span><span class="p">:</span> <span class="n">t_train</span><span class="p">,</span>
     <span class="s2">&quot;X_pool&quot;</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span> 
     <span class="s2">&quot;y_pool&quot;</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">y_test</span><span class="p">),</span>
     <span class="s2">&quot;t_pool&quot;</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">t_test</span><span class="p">),</span>
     <span class="s2">&quot;y1_pool&quot;</span><span class="p">:</span> <span class="n">y1_test</span><span class="p">,</span>
     <span class="s2">&quot;y0_pool&quot;</span><span class="p">:</span><span class="n">y0_test</span><span class="p">,</span>
     <span class="s2">&quot;X_test&quot;</span><span class="p">:</span> <span class="n">X_test</span><span class="p">,</span>
     <span class="s2">&quot;y_test&quot;</span><span class="p">:</span> <span class="n">y_test</span><span class="p">,</span>
      <span class="s2">&quot;t_test&quot;</span><span class="p">:</span> <span class="n">t_test</span><span class="p">,</span>
      <span class="s2">&quot;ite_test&quot;</span><span class="p">:</span> <span class="n">ite_test</span>
     <span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_acq</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">acq</span><span class="p">):</span>
    <span class="n">asl</span> <span class="o">=</span> <span class="n">BaseActiveLearner</span><span class="p">(</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">BARTstimator</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">estimator</span><span class="p">,</span>
                                         <span class="n">two_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ps_model</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                        <span class="n">acquisition_function</span><span class="o">=</span><span class="n">acq</span><span class="p">,</span>
                        <span class="n">assignment_function</span><span class="o">=</span><span class="n">UncertaintyAssignmentFunction</span><span class="p">(),</span>
                        <span class="n">stopping_function</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">)</span>
    <span class="n">asl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">X_new</span><span class="p">,</span> <span class="n">query_idx</span> <span class="o">=</span> <span class="n">asl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">no_query</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">query_idx</span><span class="p">)</span>
    <span class="n">asl</span><span class="o">.</span><span class="n">teach</span><span class="p">(</span><span class="n">query_idx</span><span class="p">)</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">asl</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">asl</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;X_test&quot;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">asl</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s2">&quot;Qini&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="c1"># def test_acq_ob(acq):</span>
<span class="c1">#     asl = BaseActiveLearner(estimator = OPENBTITEEstimator(model = OPENBT(</span>
<span class="c1">#         model=&quot;bart&quot;,ntrees=200),</span>
<span class="c1">#                                          two_model=False,ps_model=None),</span>
<span class="c1">#                         acquisition_function=acq,</span>
<span class="c1">#                         assignment_function=MajorityAssignmentFunction(),</span>
<span class="c1">#                         stopping_function = None,</span>
<span class="c1">#                         dataset=ds)</span>
<span class="c1">#     asl.fit()</span>
<span class="c1">#     X_new, query_idx = asl.query(no_query=10)</span>
<span class="c1">#     print(query_idx)</span>
<span class="c1">#     asl.teach(query_idx)</span>
<span class="c1">#     preds = asl.predict(asl.dataset[&quot;X_test&quot;])</span>
<span class="c1">#     print(asl.score())</span>
<span class="c1">#     return True</span>

<span class="k">def</span> <span class="nf">test_acq_gp</span><span class="p">(</span><span class="n">acq</span><span class="p">):</span>
    <span class="n">asl</span> <span class="o">=</span> <span class="n">BaseActiveLearner</span><span class="p">(</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">GPEstimator</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">GaussianProcessRegressor</span><span class="p">(</span><span class="n">ConstantKernel</span><span class="p">()</span><span class="o">*</span><span class="n">RBF</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;X_training&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],))),</span>
                                         <span class="n">two_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                    <span class="n">ps_model</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                        <span class="n">acquisition_function</span><span class="o">=</span><span class="n">acq</span><span class="p">,</span>
                        <span class="n">assignment_function</span><span class="o">=</span><span class="n">MajorityAssignmentFunction</span><span class="p">(),</span>
                        <span class="n">stopping_function</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">)</span>
    <span class="n">asl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">X_new</span><span class="p">,</span> <span class="n">query_idx</span> <span class="o">=</span> <span class="n">asl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">no_query</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">query_idx</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">asl</span><span class="o">.</span><span class="n">score</span><span class="p">())</span>
    <span class="n">asl</span><span class="o">.</span><span class="n">teach</span><span class="p">(</span><span class="n">query_idx</span><span class="p">)</span>
    <span class="n">asl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="c1">#preds = asl.predict(asl.dataset[&quot;X_test&quot;])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">asl</span><span class="o">.</span><span class="n">score</span><span class="p">())</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_acq</span><span class="p">(</span><span class="n">OPENBT</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;bart&quot;</span><span class="p">),</span> <span class="n">RandomAcquisitionFunction</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting k to agree with the model&#39;s default
Overwriting overallnu to agree with the model&#39;s default
Overwriting ntree to agree with the model&#39;s default
Overwriting ntreeh to agree with the model&#39;s default
Overwriting overallsd to agree with the model&#39;s default
Writing config file and data
/var/folders/44/gtm_t6x110jg6b13p4rbwkfh0000gn/T/openbtpy_ftkizzo6
3+ x variables
Running model...
[699 609 381 649 806 842 805 314 112 283]
0.04906324638964392
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_acq_gp</span><span class="p">(</span><span class="n">UncertaintyAcquisitionFunction</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[687 421 116 185 205 482 486 440 635 243  76 476 869 612 506 108 530 611
 268 368]
0.5337187351959323
[0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
[ 0.53038938 -0.55797198  1.52225302 -0.29576746 -0.21913841  0.79679204
  1.3020338   3.89374152  1.08700095  1.1477019   2.21613025  1.09288272
  2.93490226  1.64948686  2.07372609  0.98864345  1.93008768  0.86036131
 -0.04415296  0.48432562]
[ 1.21845907 -0.32675738  1.92124318  0.43299755 -0.00447676  1.56619227
  1.84402239  4.44810804  1.59475614  1.40139785  2.56874432  1.85665729
  3.75399006  2.41448468  2.9024177   1.75861399  2.86750032  1.65045353
  0.22963051  0.74852614]
[ 0.53038938 -0.55797198  1.52225302 -0.29576746 -0.21913841  0.79679204
  1.3020338   3.89374152  1.08700095  1.1477019   2.21613025  1.09288272
  2.93490226  1.64948686  2.07372609  0.98864345  1.93008768  0.86036131
 -0.04415296  0.48432562]
0.5751091655772831
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_acq_gp</span><span class="p">(</span><span class="n">TypeSAcquistionFunction</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[300 756 111  71 769 390 612 371 122 360 135 352 835 337 624 141 636 316
 529 142]
0.5337187351959323
[0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
[-1.36067322e-03 -5.12796861e-01  1.02289924e+00  8.38177760e-01
  1.44924400e+00  2.57422847e+00  1.64948686e+00  7.30995761e-01
  2.59964492e+00  7.20538605e-01  1.66191105e+00  2.78676717e-01
  5.00527092e-01  1.79809835e+00  3.03647193e+00  2.71252851e+00
  2.58165302e+00  2.38965847e+00  2.94782426e+00  1.25635611e+00]
[ 0.33369527 -0.33240087  1.21676014  1.56122575  1.75384184  3.40890769
  2.41448468  1.21785526  2.83841668  1.2186425   2.36359886  1.08998568
  1.05927929  2.5266249   3.41148707  3.386568    3.20981977  3.26452459
  3.29757026  1.64321664]
[-1.36067322e-03 -5.12796861e-01  1.02289924e+00  8.38177760e-01
  1.44924400e+00  2.57422847e+00  1.64948686e+00  7.30995761e-01
  2.59964492e+00  7.20538605e-01  1.66191105e+00  2.78676717e-01
  5.00527092e-01  1.79809835e+00  3.03647193e+00  2.71252851e+00
  2.58165302e+00  2.38965847e+00  2.94782426e+00  1.25635611e+00]
0.6183597398651168
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_acq_gp</span><span class="p">(</span><span class="n">EMCMAcquisitionFunction</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[199 899 308 306 305 304 303 302 301 300 299 298 297 296 295 294 293 292
 291 290]
0.5337187351959323
[0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
[ 1.24313648e-01  1.52989324e+00  1.96915558e-01  1.02021858e+00
  1.52304711e+00  9.65934285e-01  7.98132313e-01  1.52358418e+00
  1.40168734e+00 -1.36067322e-03  1.94210522e+00  7.15502131e-01
 -1.32016499e+00  3.50806262e-02  2.86028182e+00  2.80033832e+00
 -5.83705994e-02 -8.77760421e-01 -4.94267359e-01  2.33824913e+00]
[ 6.61634423e-01  1.92266739e+00  8.08301031e-01  1.63039998e+00
  1.97606387e+00  1.57041756e+00  1.44214321e+00  1.63268067e+00
  1.57287874e+00  3.33695275e-01  2.28576981e+00  1.11985145e+00
 -8.27985526e-01  7.35931053e-01  3.64530045e+00  3.32170215e+00
  1.93474920e-01  3.13327052e-03 -3.62252875e-01  3.18616992e+00]
[ 1.24313648e-01  1.52989324e+00  1.96915558e-01  1.02021858e+00
  1.52304711e+00  9.65934285e-01  7.98132313e-01  1.52358418e+00
  1.40168734e+00 -1.36067322e-03  1.94210522e+00  7.15502131e-01
 -1.32016499e+00  3.50806262e-02  2.86028182e+00  2.80033832e+00
 -5.83705994e-02 -8.77760421e-01 -4.94267359e-01  2.33824913e+00]
0.5747453437695227
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

